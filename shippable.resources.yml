# This resources are only used for MULTISITE

####################################################################
# Refer to http://docs.shippable.com/reference/resources-overview/ #
####################################################################


resources:

###############
# Common setup
###############

  # AWS Non Prod Cluster
  - name: multi-env-sit-ecs
    type: cluster
    integration: digital-nonprod-AWS
    pointer:
      sourceName : "app_ecs"
      region: "ap-southeast-2"

  # Slack connection
  - name: multi-slack-notifications
    type: notification                          #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - "#au-shippable"

  # Slack connection
  - name: multi-qa-team-notifications
    type: notification                          #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - "#bxm_qa_notifications"
        
   # Slack connection
  - name: cosmo-deployment-notifications
    type: notification                          #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - "#survivors_outlast_au"       
        
  # Slack connection
  - name: elle-deployment-notifications
    type: notification                          #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - "#survivors_outlast_au"     
        
  # Slack connection
  - name: hb-deployment-notifications
    type: notification                          #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - "#survivors_outlast_au"

  # Slack connection
  - name: gt-deployment-notifications
    type: notification                          #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - "#survivors_outlast_au"

  # Slack connection
  - name: awwfood-deployment-notifications
    type: notification                          #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - "#survivors_outlast_au"

  # Slack connection
  - name: foodnz-deployment-notifications
    type: notification                          #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - "#survivors_outlast_au"

  # Multi Github repo
  - name: multi-site-repo
    type: gitRepo
    integration: production-github
    pointer:
      sourceName: bauerxcelmedia/multi-site
      branch: master

  # SIT Parameter
  - name: multi-site-params-sit
    type: params
    version:
      params:
        NODE_ENV: "production"
        APP_ENV: "sit"
        APM_KEY: "c777240932e6282ffacc6a42ae6a0709426522bb"
        APP_DEBUG: true

  # TEST Parameter
  - name: multi-site-params-test
    type: params
    version:
      params:
        NODE_ENV: "automation"
        APP_ENV: "test"
        APP_STUBBED: true
        APP_DEBUG: true

  # AWS TEST load Balancer - MULTI STUBBED - MASTER branch
  - name: multi-site-alb-test
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/multi-site-test/14d814a6dae061c5"
      method: application

  # PROD parameters
  - name: multi-site-params-prod
    type: params
    version:
      params:
        NODE_ENV: "production"
        APP_ENV: "prod"
        APM_KEY: "c777240932e6282ffacc6a42ae6a0709426522bb"
        
  #Schedule Run of automation
  # This is using Shippable timezone
  # CRON is (30 21 * * *") this is 9:30pm every day refer to https://en.wikipedia.org/wiki/Cron
  # will run at 8:30am daylight saving or 7:30am standard time in Sydney
  - name: multi-morning-trigger
    type: time
    seed:
      interval: "30 21 * * *"

  #"0 22 * * 0" is 10:00pm Sunday which is Monday morning 9:00am daylight saving or 8:00am standard time in Sydney
  - name: elle-weekly-trigger
    type: time
    seed:
      interval: "0 22 * * 0"

  #"0 22 * * 2" is 10:00pm Tuesday which is Wednesday morning 9:00am daylight saving or 8:00am standard time in Sydney
  - name: cosmo-weekly-trigger
    type: time
    seed:
      interval: "0 22 * * 2"

  #"0 22 * * 4" is 10:00pm Thursday which is Friday morning 9:00am daylight saving or 8:00am standard time in Sydney
  - name: hb-weekly-trigger
    type: time
    seed:
      interval: "0 22 * * 4"

  #"0 22 * * 1" is 10:00pm Monday which is Tuesday morning 9:00am daylight saving or 8:00am standard time in Sydney
  - name: gt-weekly-trigger
    type: time
    seed:
      interval: "0 22 * * 1"

  #"0 22 * * 0" is 10:00pm Sunday which is Monday morning 9:00am daylight saving or 8:00am standard time in Sydney
  - name: awwfood-weekly-trigger
    type: time
    seed:
      interval: "0 22 * * 0"

  #"0 22 * * 3" is 10:00pm Wednesday which is Thursday morning 9:00am daylight saving or 8:00am standard time in Sydney
  - name: foodnz-weekly-trigger
    type: time
    seed:
      interval: "0 22 * * 3"

  #"30 22 * * 0,3" is 10:30pm Sunday & Wednesday which are Monday morning and Thursday morning 9:30am daylight saving or 8:30am standard time in Sydney
  - name: gt-perf-live-trigger
    type: time
    seed:
      interval: "30 22 * * 0,3"

  #"30 22 * * 0" is 10:30pm Sunday which is Monday morning 9:30am daylight saving or 8:30am standard time in Sydney
  - name: gt-seo-live-trigger
    type: time
    seed:
      interval: "30 22 * * 0"

  # This is for homes-site performance test and SEO test only (Workaround)
  #"30 22 * * 2,4" is 10:30pm Tuesday & Thursday which are Wednesday morning and Friday morning 9:30am daylight saving or 8:30am standard time in Sydney
  - name: homes-perf-live-trigger-workaround
    type: time
    seed:
      interval: "30 22 * * 2,4"

  #"30 22 * * 2" is 10:30pm Tuesday which is Wednesday morning 9:30am daylight saving or 8:30am standard time in Sydney
  - name: homes-perf-test-trigger-workaround
    type: time
    seed:
      interval: "30 22 * * 2"

  #"30 22 * * 3" is 10:30pm Wednesday which is Thursday morning 9:30am daylight saving or 8:30am standard time in Sydney
  - name: homes-seo-live-trigger-workaround
    type: time
    seed:
      interval: "30 22 * * 3"



##############
# COSMO
##############

  # Docker Image Options
  - name: cosmo-site-opts-sit
    type: dockerOptions
    version:
      memory: 512
      memoryReservation: 256
      cpuShares: 192
      portMappings:
        - 0:3001
      publishAllPorts : true
      logConfig:
        type: awslogs
        options:
          awslogs-group: "app_ecs"
          awslogs-region: "ap-southeast-2"
          awslogs-stream-prefix: "app-cosmo-site"

  # COSMO Seed image version MASTER Docker Image
  - name: cosmo-site-img-master
    type: image
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/cosmo-site"
    seed:
      versionName: "master.1251"  # This can be changed for Roll back

  # COSMO Seed image version Feature BRANCH Docker Image
  - name: cosmo-site-img-branch
    type: image
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/cosmo-site"
    seed:
      versionName: master.1013

  # AWS SIT load Balancer - COSMO - MASTER branch
  - name: cosmo-site-alb-sit
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/cosmo-site-au-sit/a3b55fa070484fe0"
      method: application

  # AWS SIT:8080 load Balancer - COSMO - feature BRANCH
  - name: cosmo-site-alb-sit-branch
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/cosmo-site-au-branch-sit/ab5442592721ec1e"
      method: application

##############
# ELLE
##############

  # Docker Image Options
  - name: elle-site-opts-sit
    type: dockerOptions
    version:
      memory: 512
      memoryReservation: 256
      cpuShares: 192
      portMappings:
        - 0:3001
      publishAllPorts : true
      logConfig:
        type: awslogs
        options:
          awslogs-group: "app_ecs"
          awslogs-region: "ap-southeast-2"
          awslogs-stream-prefix: "app-elle-site"

  # ELLE Seed image version MASTER Docker Image
  - name: elle-site-img-master
    type: image
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/elle-site"
    seed:
      versionName: latest

  # ELLE Seed image version Feature BRANCH Docker Image
  - name: elle-site-img-branch
    type: image
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/elle-site"
    seed:
      versionName: latest

  # AWS SIT load Balancer - ELLE - MASTER branch
  - name: elle-site-alb-sit
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/elle-site-au-sit/fba0016118605934"
      method: application

  # AWS SIT:8080 load Balancer - ELLE - feature BRANCH
  - name: elle-site-alb-sit-branch
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/elle-site-au-branch-sit/2e01f4cab451a304"
      method: application


###########################
# This section is for HB
###########################

  # HB Docker Image Options
  - name: hb-site-opts-sit
    type: dockerOptions
    version:
      memory: 512
      memoryReservation: 256
      cpuShares: 192
      portMappings:
        - 0:3001
      publishAllPorts : true
      logConfig:
        type: awslogs
        options:
          awslogs-group: "app_ecs"
          awslogs-region: "ap-southeast-2"
          awslogs-stream-prefix: "app-hb-site"

  # HB Seed image version MASTER Docker Image
  - name: hb-site-img-master
    type: image
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/hb-site"
    seed:
      versionName: latest

  # HB Seed image version feature BRANCH Docker Image
  - name: hb-site-img-branch
    type: image
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/hb-site"
    seed:
      versionName: latest

  # AWS SIT load Balancer - HB - MASTER branch
  - name: hb-site-alb-sit
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/hb-site-au-sit/1d5b3bbe8a3bdace"
      method: application

  # AWS SIT load Balancer - HB - feature BRANCH
  - name: hb-site-alb-sit-branch
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/hb-site-au-branch-sit/be93fcd0f1d50af7"
      method: application


###########################
# This section is for GT
###########################

  # GT Docker Image Options
  - name: gt-site-opts-sit
    type: dockerOptions
    version:
      memory: 512
      memoryReservation: 256
      cpuShares: 192
      portMappings:
        - 0:3001
      publishAllPorts : true
      logConfig:
        type: awslogs
        options:
          awslogs-group: "app_ecs"
          awslogs-region: "ap-southeast-2"
          awslogs-stream-prefix: "app-gt-site"

  # GT Seed image version MASTER Docker Image
  - name: gt-site-img-master
    type: image
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/gt-site"
    seed:
      versionName: latest

  # GT Seed image version feature BRANCH Docker Image
  - name: gt-site-img-branch
    type: image
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/gt-site"
    seed:
      versionName: latest

  # AWS SIT load Balancer - GT - MASTER branch
  - name: gt-site-alb-sit
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/gt-site-au-sit/6456c9a69e127fce"
      method: application

  # AWS SIT load Balancer - GT - feature BRANCH
  - name: gt-site-alb-sit-branch
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/gt-site-au-branch-sit/b0a7e7dbe4b3fb92"
      method: application

###########################
# This section is for AWWFOOD
###########################

  # AWWFOOD Docker Image Options
  - name: awwfood-site-opts-sit
    type: dockerOptions
    version:
      memory: 512
      memoryReservation: 256
      cpuShares: 192
      portMappings:
        - 0:3001
      publishAllPorts : true
      logConfig:
        type: awslogs
        options:
          awslogs-group: "app_ecs"
          awslogs-region: "ap-southeast-2"
          awslogs-stream-prefix: "app-awwfood-site"

  # AWWFOOD Seed image version MASTER Docker Image
  - name: awwfood-site-img-master
    type: image
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/awwfood-site"
    seed:
      versionName: latest

  # AWWFOOD Seed image version feature BRANCH Docker Image
  - name: awwfood-site-img-branch
    type: image
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/awwfood-site"
    seed:
      versionName: latest

  # AWS SIT load Balancer - AWWFOOD - MASTER branch
  - name: awwfood-site-alb-sit
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/awwfood-site-au-sit/0422f54150fd84f8"
      method: application

  # AWS SIT load Balancer - AWWFOOD - feature BRANCH
  - name: awwfood-site-alb-sit-branch
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/awwfood-site-au-branch-sit/11f7856c8f7dd4b7"
      method: application

###########################
# This section is for FOODNZ
###########################

  # FOODNZ Docker Image Options
  - name: foodnz-site-opts-sit
    type: dockerOptions
    version:
      memory: 512
      memoryReservation: 256
      cpuShares: 192
      portMappings:
        - 0:3001
      publishAllPorts : true
      logConfig:
        type: awslogs
        options:
          awslogs-group: "app_ecs"
          awslogs-region: "ap-southeast-2"
          awslogs-stream-prefix: "app-foodnz-site"

  # FOODNZ Seed image version MASTER Docker Image
  - name: foodnz-site-img-master
    type: image
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/foodnz-site"
    seed:
      versionName: latest

  # FOODNZ Seed image version feature BRANCH Docker Image
  - name: foodnz-site-img-branch
    type: image
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/foodnz-site"
    seed:
      versionName: latest

  # AWS SIT load Balancer - FOODNZ - MASTER branch
  - name: foodnz-site-alb-sit
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/foodnz-site-nz-sit/48061bba36a5a85a"
      method: application

  # AWS SIT load Balancer - FOODNZ - feature BRANCH
  - name: foodnz-site-alb-sit-branch
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/foodnz-site-nz-branch-sit/a0e9a08fe1f7a366"
      method: application


####################################
# PROD environment configuration
# DO NOT DELETE
# DO NOT DELETE
# DO NOT DELETE
####################################

  # AWS Prod Cluster
  - name: multi-env-prod-ecs
    type: cluster
    integration: digital-prod-AWS
    pointer:
      sourceName : "app_ecs"
      region: "ap-southeast-2"

#############
# COSMO
##############

  # Seed Release version
  # for Rollback refer to below URL
  # http://docs.shippable.com/deploy/rollback/#rolling-back-your-deployments
  - name: cosmo-site-version
    type: version
    seed:
      versionName: "1.78.0" # This can be changed for Roll back

  # AWS PROD load Balancer - COSMO PROD - MASTER branch
  - name: cosmo-site-alb-prod
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:622156575630:targetgroup/cosmo-site-au-prod/e52ec85c0832f173"
      method: application

#############
# ELLE
##############

  # Seed Release version
  # for Rollback refer to below URL
  # http://docs.shippable.com/deploy/rollback/#rolling-back-your-deployments
  - name: elle-site-version
    type: version
    seed:
      versionName: "1.0.0" # This can be changed for Roll back

  # AWS PROD load Balancer - ELLE PROD - MASTER branch
  - name: elle-site-alb-prod
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:622156575630:targetgroup/elle-site-au-prod/df1b52b88b813af7"
      method: application


#############
# HB
##############

  # Seed Release version
  # for Rollback refer to below URL
  # http://docs.shippable.com/deploy/rollback/#rolling-back-your-deployments
  - name: hb-site-version
    type: version
    seed:
      versionName: "1.0.0"  # This can be changed for Roll back

  # AWS PROD load Balancer - HB PROD - MASTER branch
  - name: hb-site-alb-prod
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:622156575630:targetgroup/hb-site-au-prod/cda8065088748b29"
      method: application


#############
# GT
##############

  # Seed Release version
  # for Rollback refer to below URL
  # http://docs.shippable.com/deploy/rollback/#rolling-back-your-deployments
  - name: gt-site-version
    type: version
    seed:
      versionName: "1.0.0"  # This can be changed for Roll back

  # AWS PROD load Balancer - HB PROD - MASTER branch
  - name: gt-site-alb-prod
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:622156575630:targetgroup/gt-site-au-prod/0f89318b85d36bfe"
      method: application


#############
# AWWFOOD
##############

  # Seed Release version
  # for Rollback refer to below URL
  # http://docs.shippable.com/deploy/rollback/#rolling-back-your-deployments
  - name: awwfood-site-version
    type: version
    seed:
      versionName: "1.0.0"  # This can be changed for Roll back

  # AWS PROD load Balancer - HB PROD - MASTER branch
  - name: awwfood-site-alb-prod
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:622156575630:targetgroup/awwfood-site-au-prod/d9eb5c3169462b22"
      method: application


#############
# FOODNZ
##############

  # Seed Release version
  # for Rollback refer to below URL
  # http://docs.shippable.com/deploy/rollback/#rolling-back-your-deployments
  - name: foodnz-site-version
    type: version
    seed:
      versionName: "1.0.0"  # This can be changed for Roll back

  # AWS PROD load Balancer - HB PROD - MASTER branch
  - name: foodnz-site-alb-prod
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:622156575630:targetgroup/foodnz-site-nz-prod/98aaa43f377d819f"
      method: application


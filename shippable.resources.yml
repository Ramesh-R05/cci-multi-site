# This resources are only used for MULTISITE

####################################################################
# Refer to http://docs.shippable.com/reference/resources-overview/ #
####################################################################


resources:

###############
# Common setup
###############

  # AWS Non Prod Cluster
  - name: multi-env-sit-ecs
    type: cluster
    integration: AWS-digital-nonprod
    pointer:
      sourceName : "app_ecs"
      region: "ap-southeast-2"

  # Slack connection
  - name: multi-slack-notifications
    type: notification                          #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - "#au-shippable"

  # Slack connection
  - name: multi-qa-team-notifications
    type: notification                          #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - "#bxm_qa_notifications"


  # Multi Github repo
  - name: multi-site-repo
    type: gitRepo
    integration: production-github
    pointer:
      sourceName: bauerxcelmedia/multi-site
      branch: master

  # SIT Parameter
  - name: multi-site-params-sit
    type: params
    version:
      params:
        NODE_ENV: "production"
        APP_ENV: "sit"
        APM_KEY: "d182e4391d2b340c7ae190bcb7a24b754f148ec4"
        APP_DEBUG: true

  # TEST Parameter
  - name: multi-site-params-test
    type: params
    version:
      params:
        NODE_ENV: "automation"
        APP_ENV: "automation"
        APP_STUBBED: true
        APP_DEBUG: true

  # AWS TEST load Balancer - MULTI STUBBED - MASTER branch
  - name: multi-site-alb-test
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/multi-site-test/14d814a6dae061c5"
      method: application

  # PROD parameters
  - name: multi-site-params-prod
    type: params
    version:
      params:
        NODE_ENV: "production"
        APP_ENV: "production"
        APM_KEY: "d182e4391d2b340c7ae190bcb7a24b754f148ec4"
        
  #Schedule Run of automation
  # This is using Shippable timezone
  # CRON is (14 22 * * *") this is 09:15pm every day refer to https://en.wikipedia.org/wiki/Cron
  # will run at 7:15am Sydney time
  - name: multi-morning-trigger
    type: time
    seed:
      interval: "14 22 * * *"        

##############
# COSMO
##############

  # Docker Image Options
  - name: cosmo-site-opts-sit
    type: dockerOptions
    version:
      memory: 512
      memoryReservation: 256
      cpuShares: 128
      portMappings:
        - 0:3001
      publishAllPorts : true
      logConfig:
        type: awslogs
        options:
          awslogs-group: "app_ecs"
          awslogs-region: "ap-southeast-2"
          awslogs-stream-prefix: "app-cosmo-site"

  # COSMO Seed image version MASTER Docker Image
  - name: cosmo-site-img-master
    type: image
    integration: AWS-digital-services-ECR
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/cosmo-site"
    seed:
      versionName: latest

  # COSMO Seed image version Feature BRANCH Docker Image
  - name: cosmo-site-img-branch
    type: image
    integration: AWS-digital-services-ECR
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/cosmo-site"
    seed:
      versionName: latest

  # AWS SIT load Balancer - COSMO - MASTER branch
  - name: cosmo-site-alb-sit
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/cosmo-site-au-sit/a3b55fa070484fe0"
      method: application

  # AWS SIT:8080 load Balancer - COSMO - feature BRANCH
  - name: cosmo-site-alb-sit-branch
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/cosmo-site-au-branch-sit/ab5442592721ec1e"
      method: application

##############
# ELLE
##############

  # Docker Image Options
  - name: elle-site-opts-sit
    type: dockerOptions
    version:
      memory: 512
      memoryReservation: 256
      cpuShares: 128
      portMappings:
        - 0:3001
      publishAllPorts : true
      logConfig:
        type: awslogs
        options:
          awslogs-group: "app_ecs"
          awslogs-region: "ap-southeast-2"
          awslogs-stream-prefix: "app-elle-site"

  # ELLE Seed image version MASTER Docker Image
  - name: elle-site-img-master
    type: image
    integration: AWS-digital-services-ECR
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/elle-site"
    seed:
      versionName: latest

  # ELLE Seed image version Feature BRANCH Docker Image
  - name: elle-site-img-branch
    type: image
    integration: AWS-digital-services-ECR
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/elle-site"
    seed:
      versionName: latest

  # AWS SIT load Balancer - ELLE - MASTER branch
  - name: elle-site-alb-sit
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/elle-site-au-sit/fba0016118605934"
      method: application

  # AWS SIT:8080 load Balancer - ELLE - feature BRANCH
  - name: elle-site-alb-sit-branch
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/elle-site-au-branch-sit/2e01f4cab451a304"
      method: application


###########################
# This section is for HB
###########################

  # HB Docker Image Options
  - name: hb-site-opts-sit
    type: dockerOptions
    version:
      memory: 512
      memoryReservation: 256
      cpuShares: 128
      portMappings:
        - 0:3001
      publishAllPorts : true
      logConfig:
        type: awslogs
        options:
          awslogs-group: "app_ecs"
          awslogs-region: "ap-southeast-2"
          awslogs-stream-prefix: "app-hb-site"

  # HB Seed image version MASTER Docker Image
  - name: hb-site-img-master
    type: image
    integration: AWS-digital-services-ECR
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/hb-site"
    seed:
      versionName: latest

  # HB Seed image version feature BRANCH Docker Image
  - name: hb-site-img-branch
    type: image
    integration: AWS-digital-services-ECR
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/hb-site"
    seed:
      versionName: latest

  # AWS SIT load Balancer - HB - MASTER branch
  - name: hb-site-alb-sit
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/hb-site-au-sit/1d5b3bbe8a3bdace"
      method: application

  # AWS SIT load Balancer - HB - feature BRANCH
  - name: hb-site-alb-sit-branch
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/hb-site-au-branch-sit/be93fcd0f1d50af7"
      method: application

####################################
# PROD environment configuration
# DO NOT DELETE
# DO NOT DELETE
# DO NOT DELETE
####################################

  # AWS Prod Cluster
  - name: multi-env-prod-ecs
    type: cluster
    integration: AWS-digital-prod
    pointer:
      sourceName : "app_ecs"
      region: "ap-southeast-2"

#############
# COSMO
##############

  # Seed Release version
  # for Rollback refer to below URL
  # http://docs.shippable.com/deploy/rollback/#rolling-back-your-deployments
  - name: cosmo-site-version
    type: version
    seed:
      versionName: "1.0.0" # This can be changed for Roll back

  # AWS PROD load Balancer - COSMO PROD - MASTER branch
  - name: cosmo-site-alb-prod
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:622156575630:targetgroup/cosmo-site-au-prod/e52ec85c0832f173"
      method: application

#############
# ELLE
##############

  # Seed Release version
  # for Rollback refer to below URL
  # http://docs.shippable.com/deploy/rollback/#rolling-back-your-deployments
  - name: elle-site-version
    type: version
    seed:
      versionName: "1.0.0" # This can be changed for Roll back

  # AWS PROD load Balancer - ELLE PROD - MASTER branch
  - name: elle-site-alb-prod
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:622156575630:targetgroup/elle-site-au-prod/df1b52b88b813af7"
      method: application


#############
# HB
##############

  # Seed Release version
  # for Rollback refer to below URL
  # http://docs.shippable.com/deploy/rollback/#rolling-back-your-deployments
  - name: hb-site-version
    type: version
    seed:
      versionName: "1.0.0"  # This can be changed for Roll back

  # AWS PROD load Balancer - HB PROD - MASTER branch
  - name: hb-site-alb-prod
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:622156575630:targetgroup/hb-site-au-prod/cda8065088748b29"
      method: application
